# AMY-Tree
Y染色体分类树

　　AMY算法可以对确定Y染色体单倍群提供准确的意见，已经通过来自不同地区的109个男性的全基因组数据来成功的验证AMY树的准确度，AMY树搜索算法使用Y染色体单倍群树，并且可以查找步骤拆分为各个子算法来并行的加快程序的处理速度，通过判断每个节点的状态来确定样品所在的染色体单倍群，AMY树的算法[23]如下：
（1）垂直子算法，垂直子算法能够通过检查每个叶节点的Y染色体单倍型对应的SNP位点的状态是否为真，由于这棵树所有的根节点都在左边而所有的叶节点都在右边，因此这个子算法又被称之为垂直子算法，在图中的矩形，方框中的单倍型为真，X1a，Z2b* and Z2b3.，
（2）但是垂直子算法并只检查了每棵树的叶节点，没有深入到树的内部，因此不能够排除SNP位点存在假阳性的可能，从而返回了一个错误的结果，因此需要对从根出发一直到每个叶节点通过节点间的链接的水平子算法来计算，由于该算法大致上是从左到右水平判断每个节点的状态，因此这个子算法也被称之为水平子算法，这种算法从左边的根节点开始逐个的检查每个子节点的状态是否为真，知道没有节点没有其子节点或者改节点的所有子节点的状态均为否，并且返回最后一个节点的状态为True的节点，如上图水平算法返回的结果为Z2b，
（3）接下来需要中和垂直子算法和水平子算法的结果来获取更准确的判断结果，只有当垂直算法返回的叶节点同时该节点也存在于水平子算法的结果中将会直接有第三子算法返回分类的结果，但是这个算法同样会由于在水平算法中纯在假阴性的节点从而照成结果的误判，如图在垂直子算法返回了结果为X1a，Z2b* and Z2b3，水平子算法返回的结果为Z2b，由于Z1的点与水平子算法的结果Z2b并不相符，因此只保留 Z2b* and Z2b3a两个点，保留的两个点均为Z2b的子节点因此，由于SNP Calling不可避免的存在大量的误差因此，因此返回保留的两个结果。
（4）第四个子算法继续对子树经行判断，查找匹配链条最为完整的路径的叶节点并返回查找的结果，本例中，该步骤返回的结果为Z2b3a，如果存在多个匹配的结果这返回匹配结果的列表作为Amy树查找的结果。
AMY树算法的强大之处在于可以组合各种不同的策略充分的利用SNP calling的结果，从而降低由于SNP Calling或者是Y染色体单倍型树造成的负面影响。
3.2.2 构建AMY-Tree
　　在进行单倍型的数据需要先生成一棵用于进行分类的AMY树，AMY树可以通过计算基因的突变距离来确定，The International Society of Genetic Genealogy (ISOGG) 是一个由志愿者维护的独立的非盈利性质机构，主张使用进化谱系来研究基因学，ISOGG促进业界的志愿者采用有NIST制定并且发布在the Journal of Genetic Genealogy上的命名规则，因此从2006年以来，ISOGG每年都会定期的对ISOGG Y染色体进化树进行更新并且接受同行的审查，由于ISOGG在业界的权威地位，因此AMY树的构建使用ISOGG 2016发布的Y染色体发育树的数据，爬取ISOGG的系统演化树并将其保存为下列格式。
Root	Root	-	-							
A00	A-L1086	Root	L1086	L1234	L1122	L1087	L1088	L1096	L1097	L1100
　　该表使用制表符进行分割，第1个字段为节点单倍型的名称，第2个字段为单倍型的替代名，第3个字段为该节点的父节点，后面剩余的字段为的为Y-SNPs的突变位点。
3.2.3 导入Y-SNP Calling数据
将SNP Calling产生的文件切割出Y染色体的SNP信息并转换为下列的格式：
chrY	10056145	G	A	x
chrY	10057061	T	G	x
chrY	10058354	A	G	rs35567891
chrY	10082860	T	G	rs35368665
　　该表使用制表符进行分割，第1个字段表示SNP位置，第2个字段表示SNP位点在染色体上的位置，第3个字段为参考序列的碱基，第4个字段为SNP Call的碱基，第5个字段为dbSNP数据库标示的SNP位点名称。
　　在后面的步骤进行之前需要先确定每个节点的突变状态，0代表和祖先型一致，1代表突变基因型，-1代表其它基因型类型，位点的状态有参考基因组和Call SNP基因组来确定，如果参考基因组过期的，导致参考基因组树的等位点状态不足以应对后续的分析，将会进行等位基因状态的检查，检查首先将确定SNP Call的质量，通过比对参考序列，通过将把检查的结果分成两个类别，有充足SNP Call的数据和不充足SNP Call的数据，接下来将要确定发育树每个节点的状态，节点状态测定的好坏取决与SNP Call的质量，当样本SNP Call的的质量足够好时，所有的Y-SNPs位点都将被用于计算SNPs的突变百分比，对于质量好的SNPs位点有超过85%可能将一个节点标示为真，当测试质量不够好的时候，计算SNPs突变率的时候将忽略等位基因所有突变的点，并且间超过5%的可能的突变位点标示为真。
3.2.4 导入突变转换文件
　　突变转化文件包含了被公开的突变转化的Y-SNPs位点信息，文件有制表符进行分割，第1个字段包含了Y-SNP位点的名称，第2个字段为Hg18 (NCBI36)的Y染色体SNP位点的位置，第3个字段为Hg19 (GRCh37)的Y染色体SNP位点的位置，第4个字段包含了突变位点的转换（标准碱基→突变碱基），第5个字段为突变位点的类型（包括单核苷酸多态性（SNP），碱基插入缺失（indel） 或者Unknown），第6个字段为该突变是否应该被忽略，SNP位点突变在任何时候都不应该被忽略，第7个字段包含根据ISOGG (International Society of Genetic Genealogy) Y染色体单倍群树可能的单倍群，第8个字段为突变代名词，第9个字段为dbSNP参考命名，全表参考附录：
L162	14528466	16019072	G->C	SNP	no	T1a	Page21	rs34179999
L164	14211253	15701859	G->A	SNP	no	R1b1a2a1a1a5c1a1a		rs13305517
L175	20355469	21896081	CTGT->del	indel	yes	R1a1a1g3a1a		
L176.1	20238645	21779257	AAAAC->del	Unknown	Yes	R1a1a1g3a1	S179.1	
3.2.5 导入质量控制文件
A1b	V148	V149	V150	V151	V153	V154
　　质量控制文件包含了所有被用于计算Call质量分数的Y-SNPs位点，文件由分隔符分割，第一个字段为单倍型的名称，其它为确定该单倍型的SNP位点。
3.2.6 参考基因组SNP状态
　　这个文件包含了参考基因组Hg18或者Hg19的参考基因组的SNP位点的状态，由制表符分割，第1个字段为Y-SNP位点的名称，第二个字段为该SNP位点的状态信息，0表示与祖先相同，1表示发生突变的位点，-1表示其它碱基状态。
L16	1
L160	0
L166	0
3.2.7 输出的分析文件
输出的分析文件可以分为以下几个部分：（1）Call质量测试里头的得分，（2）垂直算法返回的结果，水平算法返回的结果，（3）组合算法返回的结果，（4）特定算法的返回结果，（5）由结果所确定的Y染色体单倍群。
RESULTS
-------
> R1b1b2a1a1* [R-U106*]
3.2.8 输出的SNP状态文件
状态文件为Y-SNP突变转换文件给出的位点的状态，0为祖先型，1为突变型，-1为其它，reference和call为突变获取的来源，
S186	0	 reference
P227	1	 reference
M405	1	 called
S144	0	 called
M83	0	 reference
